# All Pet Plus - Visual Architecture Diagrams

**Date:** October 23, 2025  
**Purpose:** Visual representation of folder structure and architecture patterns

---

## Table of Contents

1. [Monorepo Folder Structure](#1-monorepo-folder-structure)
2. [Micro-Frontend Architecture](#2-micro-frontend-architecture)
3. [Microservices Architecture](#3-microservices-architecture)
4. [Data Flow Diagrams](#4-data-flow-diagrams)
5. [Deployment Architecture](#5-deployment-architecture)
6. [Communication Patterns](#6-communication-patterns)

---

## 1. Monorepo Folder Structure

### High-Level Organization

```
/Users/kavyrattana/Coding/pet/
â”‚
â”œâ”€â”€ ğŸ“± apps/                     Frontend Applications
â”‚   â”œâ”€â”€ web/                     Main storefront + dashboard (3000)
â”‚   â””â”€â”€ pet-licensing/           Pet licensing micro-frontend (3001)
â”‚
â”œâ”€â”€ âš™ï¸  services/                 Backend Services
â”‚   â”œâ”€â”€ backend/                 Modular monolith (4000)
â”‚   â””â”€â”€ builder-service/         Extractable microservice (4002)
â”‚
â”œâ”€â”€ ğŸ“š libs/                     Shared Libraries
â”‚   â”œâ”€â”€ api/                     tRPC API layer
â”‚   â”œâ”€â”€ domain/                  Business logic
â”‚   â”œâ”€â”€ messaging/               Event bus
â”‚   â””â”€â”€ shared/                  Common utilities
â”‚
â”œâ”€â”€ ğŸ“– docs/                     Documentation
â”‚   â”œâ”€â”€ architecture/
â”‚   â”œâ”€â”€ development/
â”‚   â”œâ”€â”€ guides/
â”‚   â””â”€â”€ ops/
â”‚
â”œâ”€â”€ ğŸ› ï¸  scripts/                 Development Scripts
â””â”€â”€ ğŸ³ docker-compose.*.yml     Container orchestration
```

### Detailed Apps Structure

```
apps/
â”‚
â”œâ”€â”€ web/ (Main App - Port 3000)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”‚   â”œâ”€â”€ (builder)/              Builder flow routes
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ customize/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ review/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ share/
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ (catalog)/              Product routes
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ shop/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ product/[id]/
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ (dashboard)/            Dashboard routes
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ layout.tsx          Dashboard shell
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx            Dashboard home
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ pets/               Pet management (built-in)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ licensing/          Licensing tab (iframe)
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ orders/             Order tracking (built-in)
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ settings/           User settings (built-in)
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â””â”€â”€ page.tsx                Landing page
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ components/
â”‚   â”‚   â”‚   â”œâ”€â”€ ui/                     UI primitives (Button, Card, etc.)
â”‚   â”‚   â”‚   â”œâ”€â”€ builder/                Builder components
â”‚   â”‚   â”‚   â”œâ”€â”€ catalog/                Catalog components
â”‚   â”‚   â”‚   â””â”€â”€ dashboard/              Dashboard components
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ lib/                        App-local utilities
â”‚   â”‚
â”‚   â”œâ”€â”€ package.json
â”‚   â”œâ”€â”€ project.json                    NX configuration
â”‚   â””â”€â”€ next.config.ts                  Next.js configuration
â”‚
â””â”€â”€ pet-licensing/ (Micro-Frontend - Port 3001)
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ app/
    â”‚   â”‚   â”œâ”€â”€ page.tsx                Public landing page
    â”‚   â”‚   â”‚   â†’ pet-licensing.harnesshero.com
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ apply/
    â”‚   â”‚   â”‚   â””â”€â”€ page.tsx            License application
    â”‚   â”‚   â”‚
    â”‚   â”‚   â”œâ”€â”€ dashboard/
    â”‚   â”‚   â”‚   â””â”€â”€ page.tsx            License management
    â”‚   â”‚   â”‚   â†’ Embedded in main dashboard
    â”‚   â”‚   â”‚
    â”‚   â”‚   â””â”€â”€ layout.tsx
    â”‚   â”‚
    â”‚   â””â”€â”€ components/                 Licensing-specific components
    â”‚
    â”œâ”€â”€ package.json                    Independent dependencies
    â””â”€â”€ project.json                    NX configuration
```

### Detailed Services Structure

```
services/
â”‚
â”œâ”€â”€ backend/ (Modular Monolith - Port 4000)
â”‚   â”œâ”€â”€ src/
â”‚   â”‚   â”œâ”€â”€ modules/                    Domain modules
â”‚   â”‚   â”‚   â”œâ”€â”€ builder/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ service.ts          BuilderService class
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ routes.ts           API endpoints
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts            Module exports
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ pet/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ service.ts          PetService class
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚   â”‚   â”‚
â”‚   â”‚   â”‚   â”œâ”€â”€ order/                  Order management
â”‚   â”‚   â”‚   â”œâ”€â”€ user/                   User management
â”‚   â”‚   â”‚   â””â”€â”€ webhook/                Webhook handling
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ routes/                     API routes (legacy)
â”‚   â”‚   â”‚   â”œâ”€â”€ designs.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ orders.ts
â”‚   â”‚   â”‚   â””â”€â”€ webhooks.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ plugins/                    Fastify plugins
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.ts                 Clerk authentication
â”‚   â”‚   â”‚   â”œâ”€â”€ db.ts                   Prisma integration
â”‚   â”‚   â”‚   â”œâ”€â”€ queue.ts                BullMQ integration
â”‚   â”‚   â”‚   â””â”€â”€ redis.ts                Redis integration
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ workers/                    Background jobs
â”‚   â”‚   â”‚   â”œâ”€â”€ preview-render.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ trigger-email.ts
â”‚   â”‚   â”‚   â””â”€â”€ webhook-replay.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ utils/                      Backend utilities
â”‚   â”‚   â”‚   â”œâ”€â”€ error-handler.ts
â”‚   â”‚   â”‚   â”œâ”€â”€ security.ts
â”‚   â”‚   â”‚   â””â”€â”€ monitoring.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ config/
â”‚   â”‚   â”‚   â””â”€â”€ database.config.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ main.ts                     Entry point
â”‚   â”‚
â”‚   â”œâ”€â”€ prisma/
â”‚   â”‚   â”œâ”€â”€ schema.prisma               Database schema
â”‚   â”‚   â”œâ”€â”€ migrations/                 Migration files
â”‚   â”‚   â””â”€â”€ seed.ts                     Seed data
â”‚   â”‚
â”‚   â”œâ”€â”€ Dockerfile
â”‚   â””â”€â”€ package.json
â”‚
â””â”€â”€ builder-service/ (Extractable Microservice - Port 4002)
    â”œâ”€â”€ src/
    â”‚   â””â”€â”€ main.ts                     Standalone Fastify service
    â”‚       â€¢ Health checks (/healthz)
    â”‚       â€¢ Readiness (/ready)
    â”‚       â€¢ Business endpoints (to be migrated)
    â”‚
    â”œâ”€â”€ Dockerfile
    â””â”€â”€ package.json                    Independent dependencies
```

### Detailed Libs Structure

```
libs/
â”‚
â”œâ”€â”€ api/ (tRPC API Layer)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ context.ts                  tRPC context (auth, db, user)
â”‚       â”œâ”€â”€ trpc.ts                     tRPC instance & procedures
â”‚       â”œâ”€â”€ root.ts                     Root router aggregation
â”‚       â”‚
â”‚       â””â”€â”€ routers/                    Domain routers
â”‚           â”œâ”€â”€ designs.ts              Design operations
â”‚           â”‚   â€¢ list, byId, create, update, delete
â”‚           â”‚
â”‚           â””â”€â”€ pets.ts                 Pet operations
â”‚               â€¢ list, byId, create, update, delete
â”‚
â”œâ”€â”€ domain/ (Business Logic)
â”‚   â””â”€â”€ src/lib/
â”‚       â”œâ”€â”€ builder/
â”‚       â”‚   â”œâ”€â”€ types.ts                BuilderConfig, BuilderSelection
â”‚       â”‚   â”œâ”€â”€ validation.ts           Zod schemas
â”‚       â”‚   â”œâ”€â”€ pricing.ts              Price calculation logic
â”‚       â”‚   â””â”€â”€ index.ts                Public API
â”‚       â”‚
â”‚       â”œâ”€â”€ pet/
â”‚       â”‚   â”œâ”€â”€ types.ts                PetProfile, PetHealth, PetBehavior
â”‚       â”‚   â”œâ”€â”€ validation.ts           Zod schemas
â”‚       â”‚   â”œâ”€â”€ utils.ts                Pet utilities
â”‚       â”‚   â””â”€â”€ index.ts                Public API
â”‚       â”‚
â”‚       â”œâ”€â”€ order/
â”‚       â”‚   â””â”€â”€ types.ts                OrderMeta types
â”‚       â”‚
â”‚       â””â”€â”€ user/
â”‚           â””â”€â”€ types.ts                UserProfile types
â”‚
â”œâ”€â”€ messaging/ (Event Bus)
â”‚   â””â”€â”€ src/
â”‚       â”œâ”€â”€ event-bus.ts                Redis Pub/Sub implementation
â”‚       â”œâ”€â”€ events.ts                   Event type definitions
â”‚       â””â”€â”€ messaging.ts                Messaging utilities
â”‚
â””â”€â”€ shared/ (Common Utilities)
    â””â”€â”€ src/lib/
        â”œâ”€â”€ constants.ts                App-wide constants
        â”œâ”€â”€ env.ts                      Environment variables
        â”œâ”€â”€ types.ts                    Common types
        â””â”€â”€ utils.ts                    Utility functions
```

---

## 2. Micro-Frontend Architecture

### Dashboard Integration Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Main Dashboard (apps/web)                     â”‚
â”‚                        Port 3000                                 â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                    Dashboard Navigation                     â”‚ â”‚
â”‚  â”‚  [My Pets] [Licensing] [Insurance] [Orders] [Settings]     â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚              â”‚              â”‚              â”‚              â”‚ â”‚
â”‚  â”‚   My Pets    â”‚  Licensing   â”‚  Insurance   â”‚   Orders     â”‚ â”‚
â”‚  â”‚   (Built-in) â”‚  (Remote)    â”‚  (Remote)    â”‚  (Built-in)  â”‚ â”‚
â”‚  â”‚              â”‚              â”‚              â”‚              â”‚ â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚ â”‚
â”‚  â”‚  â”‚ React  â”‚  â”‚  â”‚ iframe â”‚  â”‚  â”‚ iframe â”‚  â”‚  â”‚ React  â”‚  â”‚ â”‚
â”‚  â”‚  â”‚ Comps  â”‚  â”‚  â”‚ :3001  â”‚  â”‚  â”‚ :3002  â”‚  â”‚  â”‚ Comps  â”‚  â”‚ â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”¬â”€â”€â”€â”˜  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚ â”‚
â”‚  â”‚              â”‚       â”‚       â”‚       â”‚       â”‚              â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â”‚                         â”‚               â”‚                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚               â”‚
                          â–¼               â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  pet-licensing app       â”‚   â”‚  pet-insurance app   â”‚
        â”‚  (Port 3001)             â”‚   â”‚  (Port 3002)         â”‚
        â”‚                          â”‚   â”‚                      â”‚
        â”‚  â€¢ Public landing page   â”‚   â”‚  â€¢ Public landing    â”‚
        â”‚  â€¢ Application flow      â”‚   â”‚  â€¢ Quote calculator  â”‚
        â”‚  â€¢ Dashboard view        â”‚   â”‚  â€¢ Dashboard view    â”‚
        â”‚                          â”‚   â”‚                      â”‚
        â”‚  âœ… Can run standalone   â”‚   â”‚  âœ… Can run standaloneâ”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Micro-Frontend Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Pet Licensing Micro-Frontend                     â”‚
â”‚                         (Port 3001)                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ tRPC calls
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    libs/api (tRPC Routers)                       â”‚
â”‚  â€¢ licensing.list()                                              â”‚
â”‚  â€¢ licensing.create()                                            â”‚
â”‚  â€¢ licensing.verify()                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ route to
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           services/backend/modules/licensing/                    â”‚
â”‚                      OR                                          â”‚
â”‚           services/licensing-service/ (if extracted)             â”‚
â”‚  â€¢ LicensingService.list()                                       â”‚
â”‚  â€¢ LicensingService.create()                                     â”‚
â”‚  â€¢ LicensingService.verify()                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚
                             â”‚ uses
                             â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              libs/domain/pet/ (Shared Pet Data)                  â”‚
â”‚  â€¢ PetProfile types                                              â”‚
â”‚  â€¢ Validation schemas                                            â”‚
â”‚  â€¢ Business logic                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Adding New Micro-Frontend

```
         New Feature Required
                  â”‚
                  â–¼
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚  Decision Tree        â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                       â”‚
      â–¼                       â–¼
Public Landing?         Dashboard Only?
      â”‚                       â”‚
     YES                     NO
      â”‚                       â”‚
      â–¼                       â–¼
Create Micro-         Add Route in
  Frontend            apps/web/
      â”‚
      â”‚
      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  npm run scaffold                â”‚
â”‚  â†’ Frontend App                  â”‚
â”‚  â†’ pet-insurance                 â”‚
â”‚  â†’ Port 3002                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Creates:
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  apps/pet-insurance/             â”‚
â”‚  â€¢ Public landing page           â”‚
â”‚  â€¢ Application flow              â”‚
â”‚  â€¢ Dashboard view                â”‚
â”‚  â€¢ NX configuration              â”‚
â”‚  â€¢ TypeScript setup              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ Integrate:
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  apps/web/src/app/(dashboard)/  â”‚
â”‚    insurance/page.tsx            â”‚
â”‚                                  â”‚
â”‚  <iframe                         â”‚
â”‚    src="http://localhost:3002/  â”‚
â”‚         dashboard"               â”‚
â”‚  />                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
         âœ… Complete!
      (2 minutes setup)
```

---

## 3. Microservices Architecture

### Current Hybrid Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     Frontend Layer                              â”‚
â”‚                                                                  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚   apps/web   â”‚  â”‚pet-licensing â”‚  â”‚pet-insurance â”‚         â”‚
â”‚  â”‚   (3000)     â”‚  â”‚   (3001)     â”‚  â”‚   (3002)     â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚         â”‚                 â”‚                  â”‚                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â”‚                 â”‚                  â”‚
          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ tRPC over HTTP
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   API Layer (libs/api)                          â”‚
â”‚                   tRPC Router Aggregation                       â”‚
â”‚                                                                  â”‚
â”‚  export const appRouter = router({                              â”‚
â”‚    designs: designsRouter,    â†’ backend or builder-service     â”‚
â”‚    pets: petsRouter,           â†’ backend                        â”‚
â”‚    orders: ordersRouter,       â†’ backend                        â”‚
â”‚    licensing: licensingRouter, â†’ backend                        â”‚
â”‚  });                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
          â”‚                                   â”‚
          â–¼                                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  services/backend   â”‚         â”‚ services/builder-   â”‚
â”‚  (Port 4000)        â”‚         â”‚   service           â”‚
â”‚                     â”‚         â”‚ (Port 4002)         â”‚
â”‚  Modular Monolith:  â”‚         â”‚                     â”‚
â”‚  â€¢ builder/         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”¤ Extractable         â”‚
â”‚  â€¢ pet/             â”‚         â”‚ Microservice        â”‚
â”‚  â€¢ order/           â”‚         â”‚                     â”‚
â”‚  â€¢ user/            â”‚         â”‚ â€¢ Health checks     â”‚
â”‚  â€¢ webhook/         â”‚         â”‚ â€¢ Independent       â”‚
â”‚                     â”‚         â”‚   scaling           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚                               â”‚
           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ Prisma ORM
                       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   PostgreSQL Database                           â”‚
â”‚                                                                  â”‚
â”‚  â€¢ UserProfile           â€¢ SavedDesign                          â”‚
â”‚  â€¢ PetProfile            â€¢ OrderMeta                            â”‚
â”‚  â€¢ WebhookLog            â€¢ AnalyticsEvent                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Modular Monolith Internal Structure

```
services/backend/src/
â”‚
â”œâ”€â”€ modules/                          Domain Modules
â”‚   â”‚
â”‚   â”œâ”€â”€ builder/                      Design Management
â”‚   â”‚   â”œâ”€â”€ service.ts               BuilderService
â”‚   â”‚   â”‚   â€¢ listDesigns()
â”‚   â”‚   â”‚   â€¢ createDesign()
â”‚   â”‚   â”‚   â€¢ updateDesign()
â”‚   â”‚   â”‚   â€¢ deleteDesign()
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ routes.ts                API Routes
â”‚   â”‚   â”‚   â€¢ GET    /api/designs
â”‚   â”‚   â”‚   â€¢ POST   /api/designs
â”‚   â”‚   â”‚   â€¢ PATCH  /api/designs/:id
â”‚   â”‚   â”‚   â€¢ DELETE /api/designs/:id
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ index.ts                 Module Exports
â”‚   â”‚
â”‚   â”œâ”€â”€ pet/                         Pet Management
â”‚   â”‚   â”œâ”€â”€ service.ts               PetService
â”‚   â”‚   â”‚   â€¢ listPets()
â”‚   â”‚   â”‚   â€¢ createPet()
â”‚   â”‚   â”‚   â€¢ updatePet()
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ index.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ order/                       Order Tracking
â”‚   â”œâ”€â”€ user/                        User Management
â”‚   â””â”€â”€ webhook/                     Webhook Processing
â”‚
â”œâ”€â”€ plugins/                         Fastify Plugins
â”‚   â”œâ”€â”€ auth.ts                      Clerk Authentication
â”‚   â”œâ”€â”€ db.ts                        Prisma Connection
â”‚   â”œâ”€â”€ queue.ts                     BullMQ Jobs
â”‚   â””â”€â”€ redis.ts                     Redis Cache
â”‚
â”œâ”€â”€ workers/                         Background Jobs
â”‚   â”œâ”€â”€ preview-render.ts            3D Preview Generation
â”‚   â”œâ”€â”€ trigger-email.ts             Email Notifications
â”‚   â””â”€â”€ webhook-replay.ts            Webhook Retry
â”‚
â””â”€â”€ main.ts                          Application Entry
    â€¢ Initialize Fastify
    â€¢ Register plugins
    â€¢ Register modules
    â€¢ Start server
```

### Service Extraction Pattern

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Phase 1: Modular Monolith                     â”‚
â”‚                                                                   â”‚
â”‚  services/backend/src/modules/                                   â”‚
â”‚  â”œâ”€â”€ builder/                                                    â”‚
â”‚  â”œâ”€â”€ pet/                                                        â”‚
â”‚  â”œâ”€â”€ order/                                                      â”‚
â”‚  â””â”€â”€ user/                                                       â”‚
â”‚                                                                   â”‚
â”‚  âœ… Single process                                               â”‚
â”‚  âœ… Shared database                                              â”‚
â”‚  âœ… Easy to develop                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Extract high-traffic module
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Phase 2: Extract Builder Service                    â”‚
â”‚                                                                   â”‚
â”‚  services/backend/              services/builder-service/        â”‚
â”‚  â”œâ”€â”€ pet/                       â”œâ”€â”€ main.ts                      â”‚
â”‚  â”œâ”€â”€ order/                     â”œâ”€â”€ routes/                      â”‚
â”‚  â””â”€â”€ user/                      â”‚   â””â”€â”€ designs.ts               â”‚
â”‚                                 â””â”€â”€ workers/                      â”‚
â”‚                                     â””â”€â”€ preview-render.ts         â”‚
â”‚                                                                   â”‚
â”‚  âœ… Independent scaling                                          â”‚
â”‚  âœ… Still shares DB (initially)                                  â”‚
â”‚  âœ… Can deploy separately                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â”‚ Separate database
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Phase 3: True Microservices                         â”‚
â”‚                                                                   â”‚
â”‚  services/backend/              services/builder-service/        â”‚
â”‚  â”‚                               â”‚                               â”‚
â”‚  â”œâ”€â”€ PostgreSQL                  â”œâ”€â”€ PostgreSQL                  â”‚
â”‚  â”‚   (users, pets, orders)       â”‚   (designs, presets)          â”‚
â”‚  â”‚                               â”‚                               â”‚
â”‚  â””â”€â”€ Service A                   â””â”€â”€ Service B                   â”‚
â”‚                                                                   â”‚
â”‚  âœ… Independent databases                                        â”‚
â”‚  âœ… True service isolation                                       â”‚
â”‚  âœ… Different scaling per service                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4. Data Flow Diagrams

### User Design Flow (tRPC)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   User       â”‚
â”‚   Action     â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚ "Save Design"
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React Component                                              â”‚
â”‚  src/components/builder/save-button.tsx                       â”‚
â”‚                                                                â”‚
â”‚  const saveDesign = trpc.designs.create.useMutation()         â”‚
â”‚  await saveDesign.mutateAsync({ name, configJson })          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ tRPC call (type-safe)
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  tRPC Router                                                  â”‚
â”‚  libs/api/src/routers/designs.ts                             â”‚
â”‚                                                                â”‚
â”‚  create: protectedProcedure                                   â”‚
â”‚    .input(z.object({ name, configJson }))                    â”‚
â”‚    .mutation(async ({ ctx, input }) => {                     â”‚
â”‚      return ctx.db.savedDesign.create({ ... })               â”‚
â”‚    })                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ calls backend
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Backend Module                                               â”‚
â”‚  services/backend/src/modules/builder/service.ts             â”‚
â”‚                                                                â”‚
â”‚  class BuilderService {                                       â”‚
â”‚    async createDesign(userId, config) {                      â”‚
â”‚      return this.db.savedDesign.create({ ... })              â”‚
â”‚    }                                                           â”‚
â”‚  }                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ Prisma ORM
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  PostgreSQL Database                                          â”‚
â”‚                                                                â”‚
â”‚  INSERT INTO saved_design (user_id, name, config_json, ...)  â”‚
â”‚  RETURNING *;                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚ returns data
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  React Component                                              â”‚
â”‚  â€¢ Shows success message                                      â”‚
â”‚  â€¢ Invalidates cache                                          â”‚
â”‚  â€¢ Redirects to dashboard                                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Event-Driven Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Service A (Builder)                        â”‚
â”‚                 Creates new design                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Publish event
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              libs/messaging/event-bus.ts                     â”‚
â”‚                                                               â”‚
â”‚  eventBus.publish('design.created', {                        â”‚
â”‚    userId: 'user_123',                                       â”‚
â”‚    designId: 'design_456',                                   â”‚
â”‚    timestamp: new Date(),                                    â”‚
â”‚  });                                                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Redis Pub/Sub
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Redis Event Bus                         â”‚
â”‚                    Channel: 'events'                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚               â”‚               â”‚
           â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Analytics   â”‚  â”‚    Email     â”‚  â”‚    Audit     â”‚
â”‚  Service     â”‚  â”‚   Service    â”‚  â”‚   Service    â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ Subscribe:   â”‚  â”‚ Subscribe:   â”‚  â”‚ Subscribe:   â”‚
â”‚ 'design.*'   â”‚  â”‚ 'design.*'   â”‚  â”‚ '*'          â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ â€¢ Log event  â”‚  â”‚ â€¢ Send       â”‚  â”‚ â€¢ Record     â”‚
â”‚ â€¢ Aggregate  â”‚  â”‚   congrats   â”‚  â”‚   audit log  â”‚
â”‚              â”‚  â”‚   email      â”‚  â”‚              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Webhook Processing Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Shopify                               â”‚
â”‚                  Order Created Webhook                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ POST /webhooks/shopify/orders
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              services/backend/routes/webhooks.ts             â”‚
â”‚                                                               â”‚
â”‚  1. Verify HMAC signature                                    â”‚
â”‚  2. Validate payload                                         â”‚
â”‚  3. Store in WebhookLog                                      â”‚
â”‚  4. Publish event                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Publish 'order.created'
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Redis Event Bus                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚               â”‚               â”‚
           â–¼               â–¼               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Order      â”‚  â”‚   Email      â”‚  â”‚  Analytics   â”‚
â”‚  Service     â”‚  â”‚  Service     â”‚  â”‚   Service    â”‚
â”‚              â”‚  â”‚              â”‚  â”‚              â”‚
â”‚ â€¢ Create     â”‚  â”‚ â€¢ Send       â”‚  â”‚ â€¢ Track      â”‚
â”‚   OrderMeta  â”‚  â”‚   confirmationâ”‚  â”‚   conversion â”‚
â”‚ â€¢ Link to    â”‚  â”‚ â€¢ Send to    â”‚  â”‚ â€¢ Update     â”‚
â”‚   SavedDesignâ”‚  â”‚   customer   â”‚  â”‚   metrics    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 5. Deployment Architecture

### Development Environment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Local Development                          â”‚
â”‚                    docker-compose.microservices.yml              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Infrastructure                             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   PostgreSQL         â”‚        â”‚      Redis           â”‚      â”‚
â”‚  â”‚   Port: 5432         â”‚        â”‚      Port: 6379      â”‚      â”‚
â”‚  â”‚   harness_hero DB    â”‚        â”‚      Pub/Sub + Cache â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Backend Services                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   backend            â”‚        â”‚  builder-service     â”‚      â”‚
â”‚  â”‚   Port: 4000         â”‚        â”‚  Port: 4002          â”‚      â”‚
â”‚  â”‚   Monolith           â”‚        â”‚  Replicas: 2         â”‚      â”‚
â”‚  â”‚   â€¢ builder/         â”‚        â”‚  â€¢ High traffic      â”‚      â”‚
â”‚  â”‚   â€¢ pet/             â”‚        â”‚  â€¢ CPU intensive     â”‚      â”‚
â”‚  â”‚   â€¢ order/           â”‚        â”‚                      â”‚      â”‚
â”‚  â”‚   â€¢ user/            â”‚        â”‚                      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       Frontend Apps                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚   web                â”‚        â”‚  pet-licensing       â”‚      â”‚
â”‚  â”‚   Port: 3000         â”‚        â”‚  Port: 3001          â”‚      â”‚
â”‚  â”‚   Main app           â”‚        â”‚  Micro-frontend      â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Production Deployment

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                           Vercel (Frontend)                      â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  web.harnesshero.com     â”‚    â”‚ pet-licensing.harness-   â”‚  â”‚
â”‚  â”‚  (Main App)              â”‚    â”‚ hero.com                 â”‚  â”‚
â”‚  â”‚                          â”‚    â”‚ (Micro-Frontend)         â”‚  â”‚
â”‚  â”‚  â€¢ Edge Functions        â”‚    â”‚                          â”‚  â”‚
â”‚  â”‚  â€¢ Global CDN            â”‚    â”‚ â€¢ Independent Deploy     â”‚  â”‚
â”‚  â”‚  â€¢ Auto-scaling          â”‚    â”‚ â€¢ Own Domain             â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                              â”‚
                â”‚ API Calls (tRPC over HTTPS)  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Fly.io / AWS ECS (Backend)                    â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  api.harnesshero.com     â”‚    â”‚ builder.harnesshero.     â”‚  â”‚
â”‚  â”‚  (Main Backend)          â”‚    â”‚ internal                 â”‚  â”‚
â”‚  â”‚                          â”‚    â”‚ (Builder Service)        â”‚  â”‚
â”‚  â”‚  Instances: 1-4          â”‚    â”‚                          â”‚  â”‚
â”‚  â”‚  Auto-scale: CPU > 70%   â”‚    â”‚ Instances: 2-10          â”‚  â”‚
â”‚  â”‚  Health: /healthz        â”‚    â”‚ Auto-scale: Req > 1000/m â”‚  â”‚
â”‚  â”‚  Resources:              â”‚    â”‚ Health: /healthz         â”‚  â”‚
â”‚  â”‚  â€¢ 1 vCPU, 1GB RAM       â”‚    â”‚ Resources:               â”‚  â”‚
â”‚  â”‚                          â”‚    â”‚ â€¢ 1 vCPU, 1GB RAM        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                              â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â”‚
                               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   Managed Services                               â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  PostgreSQL              â”‚    â”‚  Redis                   â”‚  â”‚
â”‚  â”‚  (AWS RDS / Supabase)    â”‚    â”‚  (Upstash / Redis Cloud) â”‚  â”‚
â”‚  â”‚                          â”‚    â”‚                          â”‚  â”‚
â”‚  â”‚  â€¢ Automated backups     â”‚    â”‚  â€¢ Pub/Sub + Cache       â”‚  â”‚
â”‚  â”‚  â€¢ Read replicas         â”‚    â”‚  â€¢ High availability     â”‚  â”‚
â”‚  â”‚  â€¢ Connection pooling    â”‚    â”‚  â€¢ Auto-scaling          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 6. Communication Patterns

### Type-Safe API Calls (tRPC)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Frontend Component                          â”‚
â”‚  apps/web/src/components/builder/saved-designs.tsx              â”‚
â”‚                                                                   â”‚
â”‚  const { data, isLoading } = trpc.designs.list.useQuery({       â”‚
â”‚    limit: 20,                                                    â”‚
â”‚  });                                                              â”‚
â”‚                                                                   â”‚
â”‚  âœ… Full TypeScript autocomplete                                â”‚
â”‚  âœ… Compile-time type checking                                  â”‚
â”‚  âœ… No manual API client                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ HTTP POST /api/trpc/designs.list
                           â”‚ { input: { limit: 20 } }
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     tRPC API Handler                             â”‚
â”‚  libs/api/src/routers/designs.ts                                â”‚
â”‚                                                                   â”‚
â”‚  export const designsRouter = router({                           â”‚
â”‚    list: protectedProcedure                                      â”‚
â”‚      .input(z.object({ limit: z.number() }))                    â”‚
â”‚      .query(async ({ ctx, input }) => {                         â”‚
â”‚        return ctx.db.savedDesign.findMany({                     â”‚
â”‚          where: { userId: ctx.userId },                         â”‚
â”‚          take: input.limit,                                      â”‚
â”‚        });                                                        â”‚
â”‚      }),                                                          â”‚
â”‚  });                                                              â”‚
â”‚                                                                   â”‚
â”‚  âœ… Runtime validation (Zod)                                    â”‚
â”‚  âœ… Authentication enforced                                     â”‚
â”‚  âœ… Database access via context                                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Response with inferred types
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Frontend Component                          â”‚
â”‚                                                                   â”‚
â”‚  data: {                                                         â”‚
â”‚    id: string;                 â† Fully typed!                   â”‚
â”‚    name: string | null;        â† Nullability preserved!         â”‚
â”‚    configJson: BuilderConfig;  â† Domain types!                  â”‚
â”‚    createdAt: Date;            â† Proper Date objects!           â”‚
â”‚  }[]                                                              â”‚
â”‚                                                                   â”‚
â”‚  âœ… No type casting needed                                      â”‚
â”‚  âœ… Safe property access                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Import Pattern Visualization

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Import Hierarchy                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Frontend Components
    â”‚
    â”œâ”€â”€ import { trpc } from '@/lib/trpc'              (app-local)
    â”œâ”€â”€ import { Button } from '@/components/ui/button' (app-local)
    â”‚
    â”œâ”€â”€ import { BuilderConfig } from '@pet/domain/builder'  (shared)
    â”œâ”€â”€ import { PetProfile } from '@pet/domain/pet'         (shared)
    â”œâ”€â”€ import { formatPrice } from '@pet/shared'            (shared)
    â”‚
    â””â”€â”€ import { OptionCard } from './option-card'      (relative)

Backend Services
    â”‚
    â”œâ”€â”€ import { BuilderConfig } from '@pet/domain/builder'  (shared)
    â”œâ”€â”€ import { builderConfigSchema } from '@pet/domain/builder' (shared)
    â”œâ”€â”€ import { eventBus } from '@pet/messaging'            (shared)
    â”œâ”€â”€ import { formatDate } from '@pet/shared'             (shared)
    â”‚
    â””â”€â”€ import { BuilderService } from './service'      (relative)

âœ… Shared libraries used by all
âœ… App-local code stays local
âœ… Clear boundaries
```

---

## Conclusion

This visual architecture documentation demonstrates:

1. **Clear Organization** - Every file has its place
2. **Type-Safe Communication** - tRPC ensures end-to-end types
3. **Flexible Scaling** - Start monolith, extract services when needed
4. **Infinite Extensibility** - Add micro-frontends in 2 minutes
5. **Production Ready** - Health checks, monitoring, deployment patterns

**Architecture Quality: A+**

The folder structure and patterns support rapid development while maintaining the flexibility to scale from 1 to 100+ services without major restructuring.

---

**Related Documentation:**
- `/docs/analysis/codebase-structure-analysis.md` - Detailed text analysis
- `/docs/architecture/microservices-architecture.md` - Microservices design
- `/docs/architecture/microfrontend-architecture.md` - Micro-frontend patterns

**Last Updated:** October 23, 2025

